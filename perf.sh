#!/bin/bash

query=$1
if [ $# > 1 ]; then
END=$2
else
END=10
fi

bwHost="http://stg-cardapi.slingstone.gq1.yahoo.com:4080"
avengersHost="http://asap.gsm.search.yahoo.com:4080"
wscHost="http://us.gsmwsc.search.yahoo.com:4080"
bw="$bwHost/broadway/v1/cards?context.property=search&bucket=B1579&format=dunkv3&context.latitude=37.416974&context.longitude=-122.025480&query=$query"
avengers="$avengersHost/search?hits=8&intl=us&device=desktop&lang=en-US&region=US&appid=web&qp.src=web&v=2&bingLang=en-US&enableMultiLayer=true&enableBDILogging=true&isGeneva=0&woeid=2502265&ulmWoeId=2502265&hloc=woeid%3A2502265%3Bzip%3A94089&ipWoeId=12797150&WoeHrchy=1%2C23424977%2C2347563%2C12587712%2C2502265&ip=2001%3A4998%3Aeffd%3A50c%3A593c%3Ae639%3Aafaf%3A24c0&uIP=2001%3A4998%3Aeffd%3A50c%3A593c%3Ae639%3Aafaf%3A24c0&rawUserAgent=Mozilla%2F5.0%20(Macintosh%3B%20Intel%20Mac%20OS%20X%2010_11_3)%20AppleWebKit%2F601.4.4%20(KHTML%2C%20like%20Gecko)%20Version%2F9.0.3%20Safari%2F601.4.4&ycookie=v%3D1%26n%3Dbqq7mh3n3uii9%26l%3Drxv2s421uw24y0tw10x2ux0s00ryyx43%2Fo%26p%3Dm260000012000000%26r%3Dtp%26lg%3Den-US%26intl%3Dus%26np%3D1&bcookie=7mck59pb5cb22%26b%3D4%26d%3DLVqmpjdpYEJupy74dQomb.zSo1s-%26s%3Dgg%26i%3D0gxrmQTG5hPElZ2vuOCK&tcookie=z%3D6c21WB5GK4WBmfpoYzLcE7jNDY3NwY2MzE0MTFOTk5PNE40NU%26a%3DQAE%26sk%3DDAAYfm6nRouJf9%26ks%3DEAATaqCYmGLGDH931b8.23eyQ--~E%26d%3Dc2wBTXpFd01BRXhORFl6TmpZNU9UazRNemt6TWpreU5RLS0BYQFRQUUBZwFWT01JSU1ZUTRZNzZWNzRJTU1NQlhaU05ENAFzY2lkAVFOeWw4THdMY2xwMVBJdHhCVDE3d2JoMTltSS0BYWMBQUxhek9UZDQBYWwBcGhpbG9oQHlhaG9vLWluYy5jb20BdGlwAXVEd0UxRAFzYwFzYW1sAWZzAXhVdXRhT1pXREhvYgF6egE2YzIxV0JmZEM-%26af%3DQUFBQ0FDQURDSUFFdUF1QnVlOW9DSkFCT1cmdHM9MTQ1Njk1NzI0MiZwcz04blMudWRrTjJxQWY3MmMuMHQySkVnLS0-&cluster=gq1&isRobot=false&pvid=XyzJgQrXmRZ7MoVOVlYsQgAAfwAAAVbYuAgAAnSs&spaceid=2114700559&vm=i&fr=yhs-avg-fh_lsonsw&fr2=sb-top-search&config.ads.curveball.enabled=false&yhs_sysconfig=%7B%22uni%22%3A%7B%22params%22%3A%7B%22adSourceTag%22%3A%22yhs_avg_mysearch_ls_on_fh_notab%22%2C%22adType%22%3A%22yhsavg%3Db1335-yhs-avg-fh_lsonsw-ch.45.ot.hp._.us.avg._._%22%7D%7D%7D&fl=0&config.web.ysm_partner_override=yhs_avg_mysearch_ls_on_fh_notab&__uni_params=adEnableClickWrapping%3D1%7CreqScheme%3Dhttps%7CGAds%3D0&hspart=avg&hsimp=yhs-fh_lsonsw&os=mac%20os%20x&osver=10.11&iguid=0ad799165f2c49818056d8b808a274a9&bingEncrypted=09qn%2FibAG%2BIdutT8piI8CtzZlFYv1knIuXu0OfQtNkC4HZoXpgqJ32EgU3FBGacK7KTuhu6E57SA%2FlIaDmeDER%2BYXj8uM6WXsHJ9pN6cxQDTFGOFn%2FRG2HVUCJWnX1fdQZdYER4dPT%2Fl6ZxZD5rQUAaEdIx%2FtpnijhFX9NWKOpgKGGZ47r0ADmN74DFLvDphzahnh96eHDRpkazA6xAxAn78NYAPt0d1IUvX1pAP5bSWk%3D&sslCookie=v%3D1%26s%3Dh5PKpCJA_xTcOS.MLQC61jgMqx0F83ZW9hYXAMoOycHyyGqhQla8kHefypmMbV6YozwRm6eDSkx.KOfkK54Vlg--%26kv%3D0&offset=0&sx=2&timeStamp=1457043464&browserVendor=webkit&browserName=safari&browserVersion=9.0&wssid=g2vxYk4qslo&ffpe=1&clientid=5cf0f97d894a573281d0e21730f28e2d&scheme=https&yuid=175c2ecb46ce8a36ba7c47a2aa1887ed%23tp&regweek=953&userGuid=VOMIIMYQ4Y76V74IMMMBXZSND4&ssn=0&userInfoGender=M&userAge=45-49&userInfoZip=94089&userInfoCountry=us&device_platform=macintosh&isInternalUser=true&query=$query"
wsc="$wscHost/lpm?ip=2001%3A4998%3Aeffd%3A50c%3A593c%3Ae639%3Aafaf%3A24c0&spaceid=2766679&rawUserAgent=Mozilla%2F5.0+%28Macintosh%3B+Intel+Mac+OS+X+10.11%3B+rv%3A40.0%29+Gecko%2F20100101+Firefox%2F40.0&ipWoeId=2502265&ulmWoeId=2502265&woeid=2502265&WoeHrchy=1%2C23424977%2C2347563%2C24701119%2C12587712%2C2502265%2C12797150&hloc=woeid%3A2502265%3Bzip%3A94089&intl=us&pvid=uIWe6TIwOC7yfgZZVbFe4ALiMjAwMQAAAAC0.N1_&device=desktop&sx=0&vm=i&cluster=gq1&testid=B1779&timeStamp=1457044921&fl=0&clientid=eea0c27a95675e4f8283195999f15815&iguid=448ef320b8854ee9a200000000f8dd79&bingLang=en-US&bingEncrypted=09O64V4OTjLLtyP28s6wZlel4QkMDOiRkDpLh6bI0FLqqywuL24NQaD0feqgvq3lLmpokDY39AsJL9NoZxCnp854dyP%2Bljpw2eGLKq%2BbApZFPfyrm%2F0pL0JoE6H4kzvlxIRBvofCDFGhuw8tmOcMTcoS0PKCOs8i8Ccbj5kkVGuDaeTqdtdlzYVoPRetJz98K33qzEc7rvu6%2BT0pJyx6cfQQxthBp3GP5MQkKQXi96E%2BQ%3D&isRobot=false&isInternalUser=true&fr=sfp&fr2=sb-top-searchÂ®ion=US&bcookie=f4vg6b5ar2nn0%26b%3D4%26d%3DLVqmpjdpYEJupy74dQomb.zSo1s-%26s%3Del%26i%3DtfVgvo1yYOE3TsBU2iSh&privateResult=0&wssid=HOaELmQRCIR&osver=10.11&appid=web&enableMultiLayer=true&lang=en-US&env=development&scheme=https&browserName=firefox&browserVersion=40.0&browserVendor=gecko&ffpe=1&bct=0&loginTimeout=1&__uni_params=cbEnableCB%3D1%7CGAds%3D0%7CreqScheme%3Dhttps%7CadEnableClickWrapping%3D1&isGeneva=0&providerArgs=ecbw%3D1%26bct%3D0%26ecb%3D1%26tq%3D9%26compl%3D0%26pagenum%3D1%26tqv%3D20160302%26comv%3D20160302%26com%3D2&hits=10&offset=0&qp.src=web&os=mac+os+x&query=$query"

echo "BW" $query $bwHost
for (( c=1; c<=$END; c++ )) do curl -s -w "%{time_total} %{size_download} %{http_code}\n" -o /dev/null "$bw";done | awk -F " " 'BEGIN {max=0;min=100000} {if($1>max) max=$1; if($1<min) min=$1; sum+=$1; printf "%s\t",$1} END {print "\nAVG =",sum/NR, "MAX=",max, "MIN=",min}'

echo "avengers" $query $avengersHost
for (( c=1; c<=$END; c++ )) do curl -s -w "%{time_total} %{size_download} %{http_code}\n" -o /dev/null "$avengers";done | awk -F " " 'BEGIN {max=0;min=100000} {if($1>max) max=$1; if($1<min) min=$1; sum+=$1; printf "%s\t",$1} END {print "\nAVG =",sum/NR, "MAX=",max, "MIN=",min}'

echo "WSC" $query $wscHost
for (( c=1; c<=$END; c++ )) do curl -s -w "%{time_total} %{size_download} %{http_code}\n" -o /dev/null "$wsc";done | awk -F " " 'BEGIN {max=0;min=100000} {if($1>max) max=$1; if($1<min) min=$1; sum+=$1; printf "%s\t",$1} END {print "\nAVG =",sum/NR, "MAX=",max, "MIN=",min}'